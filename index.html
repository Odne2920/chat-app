<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">    <title>HRN Secure Chat</title>    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>    <script src="https://unpkg.com/lucide@latest"></script>    <style>        :root { --bg: #f8f9ff; --surface: #ffffff; --border: #000000; --text-main: #000000; --text-mute: #444446; --accent: #007aff; --danger: #ff3b30; --success: #28a745; --pad: 32px; }        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }        body { height: 100dvh; background: #e5e5ea; color: var(--text-main); display: flex; justify-content: center; align-items: center; overflow: hidden; }        #app { width: 100%; max-width: 440px; height: 100%; position: relative; display: flex; flex-direction: column; background: var(--bg); box-shadow: 0 20px 50px rgba(0,0,0,0.2); overflow: hidden; }        #toast-container { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 99999; display: flex; flex-direction: column-reverse; gap: 8px; width: 90%; pointer-events: none; }        .toast-item { background: #000000; color: #ffffff; padding: 16px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); pointer-events: auto; animation: slideIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); border: 1px solid rgba(255,255,255,0.1); }        .toast-link { color: #5ac8fa; text-decoration: underline; cursor: pointer; margin-left: 5px; font-weight: 800; }        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }        .screen { position: absolute; inset: 0; display: none; flex-direction: column; padding: var(--pad); background: var(--bg); }        .screen.active { display: flex; z-index: 10; }        .center-content { justify-content: center; text-align: center; }        .header { display: flex; align-items: center; justify-content: space-between; padding-bottom: 20px; border-bottom: 2px solid #000; margin-bottom: 32px; }        .title { font-size: 32px; font-weight: 850; letter-spacing: -1.2px; color: #000; margin-bottom: 8px; }        .subtitle { color: var(--text-mute); font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 32px; }        .input-field { width: 100%; background: #ffffff; border: 2px solid #000; border-radius: 12px; padding: 18px; color: #000; font-size: 16px; font-weight: 600; outline: none; margin-bottom: 16px; transition: 0.2s; }        .input-field:focus { border-color: var(--accent); box-shadow: 4px 4px 0px #000; }        .btn { width: 100%; height: 60px; border-radius: 12px; border: 2px solid #000; background: #fff; color: #000; font-weight: 800; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; position: relative; top: 0; }        .btn:active { top: 2px; box-shadow: none; }        .btn-accent { background: #000; color: #fff; }        .btn-cancel { border: none; margin-top: 15px; color: var(--text-mute); font-weight: 700; background: transparent; text-decoration: underline; }        #room-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }        .room-card { padding: 22px; border-radius: 14px; background: #fff; border: 2px solid #000; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }        .room-card span { font-weight: 800; color: #000; }        #chat-messages { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; padding: 10px 2px; }        .msg { width: fit-content; max-width: 85%; padding: 12px 16px; border-radius: 16px; background: #ffffff; border: 2px solid #000; font-size: 15px; font-weight: 600; line-height: 1.4; color: #000; }        .msg.me { align-self: flex-end; background: #000; color: #fff; border-bottom-right-radius: 4px; }        .msg-user { font-size: 11px; font-weight: 900; color: var(--accent); margin-bottom: 4px; display: block; }        .msg.me .msg-user { color: #5ac8fa; }        #loader-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.9); z-index: 99999; display: none; align-items: center; justify-content: center; }        #loader-overlay.active { display: flex; }        .spinner { width: 40px; height: 40px; border: 5px solid #eee; border-top-color: #000; border-radius: 50%; animation: spin 0.8s linear infinite; }        @keyframes spin { to { transform: rotate(360deg); } }    </style></head><body><div id="app">    <div id="loader-overlay"><div class="spinner"></div></div>    <div id="toast-container"></div>    <div id="scr-start" class="screen active center-content">        <i data-lucide="shield-check" size="64" color="#000" style="margin: 0 auto 24px;"></i>        <h1 class="title">HRN SECURE</h1><p class="subtitle">Next-Gen Privacy</p>        <button class="btn btn-accent" onclick="window.nav('scr-login')">Sign In</button>        <button class="btn" style="margin-top:12px" onclick="window.nav('scr-register')">Create Account</button>    </div>    <div id="scr-register" class="screen center-content">        <h1 class="title">New Identity</h1><p class="subtitle">Zero-knowledge signup</p>        <input type="text" id="r-name" class="input-field" placeholder="Full Name" autocomplete="off" spellcheck="false">        <input type="email" id="r-email" class="input-field" placeholder="Email" autocomplete="off" spellcheck="false">        <input type="password" id="r-pass" class="input-field" placeholder="Security Key (min 6)" autocomplete="off">        <button class="btn btn-accent" onclick="window.handleRegister()">Initialize</button>        <button onclick="window.nav('scr-start')" class="btn btn-cancel">Back</button>    </div>    <div id="scr-login" class="screen center-content">        <h1 class="title">Verify</h1><p class="subtitle">Welcome back</p>        <input type="email" id="l-email" class="input-field" placeholder="Email" autocomplete="off">        <input type="password" id="l-pass" class="input-field" placeholder="Password" autocomplete="off">        <button class="btn btn-accent" onclick="window.handleLogin()">Unlock Access</button>        <button onclick="window.nav('scr-start')" class="btn btn-cancel">Back</button>    </div>    <div id="scr-lobby" class="screen">        <div class="header"><h1 class="title">Vaults</h1><i data-lucide="plus" size="28" onclick="window.nav('scr-create')" class="clickable"></i></div>        <div id="room-list"></div>    </div>    <div id="scr-chat" class="screen">        <div class="header"><i data-lucide="chevron-left" size="28" onclick="window.leaveChat()" class="clickable"></i><h2 id="chat-title" style="font-weight:850">---</h2><div></div></div>        <div id="chat-messages"></div>        <div style="display: flex; gap: 10px; margin-top:20px">            <input id="chat-input" class="input-field" style="margin:0" placeholder="Secure message..." autocomplete="off">            <button class="btn btn-accent" style="width:60px" onclick="window.sendMsg()"><i data-lucide="send" size="20"></i></button>        </div>    </div>    <div id="scr-verify" class="screen center-content">        <h1 class="title">Verify</h1><p class="subtitle">Check your email</p>        <input type="number" id="v-code" class="input-field" placeholder="0 0 0 0 0 0">        <button class="btn btn-accent" onclick="window.handleVerify()">Confirm</button>    </div></div><script type="module">import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const URL = "https://fahbqdajxnhswevdagdn.supabase.co", KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhaGJxZGFqeG5oc3dldmRhZ2RuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTEyODEsImV4cCI6MjA4NjEyNzI4MX0.UPgPxyaWBULjH4jL8UaSr6bJXTsFWWJRIYodHmXeVTI", GAS_URL = "https://script.google.com/macros/s/AKfycbwoHBjaZgzAiv0G9iKfKriKMPxA9Zjm0Fg9dQjtuJuCntuSe3oPP9uvxu1LzwF8aPER/exec", SALT = "H7a1lPjHvVBA5", db = createClient(URL, KEY);let user = null, room = null, sub = null, tempReg = {};window.nav = (id) => { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); lucide.createIcons(); };window.toast = (msg, html = false) => { const container = document.getElementById('toast-container'), t = document.createElement('div'); t.className = 'toast-item'; if(html) t.innerHTML = msg; else t.innerText = msg; container.appendChild(t); setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 400); }, 4000); };window.setLoading = (l) => document.getElementById('loader-overlay').classList.toggle('active', l);window.suggestName = (n) => { document.getElementById('r-name').value = n; };window.handleRegister = async () => { const n = document.getElementById('r-name').value.trim(), e = document.getElementById('r-email').value.trim(), p = document.getElementById('r-pass').value.trim(); if(!n) { const s = "User" + Math.floor(Math.random()*9999); return window.toast(`Name required. Use <span class="toast-link" onclick="window.suggestName('${s}')">${s}</span>?`, true); } if(!e.includes('@')) return window.toast("Invalid Email"); if(p.length < 6) return window.toast("Password too short (min 6)"); window.setLoading(true); try { const { data } = await db.from('profiles').select('id').eq('email', e).maybeSingle(); if(data) { window.toast("Account exists. Please sign in."); return window.nav('scr-login'); } await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: "send", email: e }) }); tempReg = { n, e, p }; window.toast("Verification code sent!"); window.nav('scr-verify'); } catch(err) { window.toast("Connection Error"); } finally { window.setLoading(false); } };window.handleLogin = async () => { const e = document.getElementById('l-email').value, p = document.getElementById('l-pass').value; window.setLoading(true); const { data, error } = await db.auth.signInWithPassword({ email: e, password: p }); if(!error) { user = data.user; window.loadRooms(); window.nav('scr-lobby'); } else window.toast("Access Denied: Invalid Credentials"); window.setLoading(false); };window.loadRooms = async () => { const { data } = await db.from('rooms').select('*').eq('is_private', false); document.getElementById('room-list').innerHTML = data.map(r => `<div class="room-card" onclick="window.openVault('${r.id}','${r.name}')"><span>${r.name}</span><i data-lucide="chevron-right" size="20"></i></div>`).join(''); lucide.createIcons(); };window.openVault = async (id, name) => { window.setLoading(true); room = id; document.getElementById('chat-title').innerText = name; const { data } = await db.from('messages').select('*').eq('room_id', id).order('created_at', { ascending: true }); document.getElementById('chat-messages').innerHTML = data.map(m => `<div class="msg ${m.user_id === user.id ? 'me' : ''}"><span class="msg-user">${m.user_name}</span>${CryptoJS.AES.decrypt(m.content, SALT).toString(CryptoJS.enc.Utf8).substring(7)}</div>`).join(''); window.nav('scr-chat'); window.setLoading(false); };window.sendMsg = async () => { const i = document.getElementById('chat-input'), v = i.value.trim(); if(!v) return; i.value = ''; const c = CryptoJS.AES.encrypt(`[00:00]${v}`, SALT).toString(); await db.from('messages').insert([{ room_id: room, user_id: user.id, user_name: user.user_metadata.full_name, content: c }]); window.openVault(room, document.getElementById('chat-title').innerText); };window.handleVerify = async () => { window.setLoading(true); const { data, error } = await db.auth.signUp({ email: tempReg.e, password: tempReg.p, options: { data: { full_name: tempReg.n } } }); if(!error) { await db.from('profiles').insert([{ id: data.user.id, full_name: tempReg.n, email: tempReg.e }]); user = data.user; window.loadRooms(); window.nav('scr-lobby'); } else window.toast(error.message); window.setLoading(false); };lucide.createIcons();</script></body></html>
